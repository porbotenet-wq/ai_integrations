# Проектирование Mini App на базе логики Telegram‑бота ГПР и ваших таблиц

## Исходная логика и что Mini App обязан закрыть

Текущая система (бот) решает управленческую проблему координации множества отделов по фасадным контрактам через единые сущности «объект → ГПР → задачи → документы → согласования → уведомления», с контролем план/факт и эскалациями. fileciteturn0file0

Ключевой вывод для Mini App: у вас уже есть процессы, которые принципиально «не помещаются» в чат и требуют web‑интерфейса с таблицами, фильтрами, формами, версиями и журналом действий. В архитектуре бота это прямо описано: ГПР — табличная структура 135+ строк (и несколько колонок), плюс потребность в Ганте, дашбордах, чек‑листах монтажных этапов и формах с фотофиксацией — всё это относится к Mini App как обязательному слою UX. fileciteturn0file0

Технически Mini App встраивается внутрь entity["company","Telegram","messaging platform"] и может передавать данные обратно в бота через WebApp API (например, `Telegram.WebApp.sendData`). citeturn0search1  
Далее критично: авторизацию Mini App нужно строить на проверке init data (данные запуска), потому что это фактически ваш «одношаговый SSO» в Telegram‑контуре. citeturn0search0turn0search2

## Разбор «семейств таблиц» и какие продуктовые модули из них следуют

Ниже — практическая интерпретация ваших таблиц как источников требований. Цель — не «перерисовать Excel», а выделить стабильные доменные объекты и то, как их должен показывать Mini App.

### Контур управления проектом и ГПР

В боте контур управления строится вокруг сущностей «Объект», «ГПР», «Задача», «Документ», «Согласование», «Поставка», «Уведомление» и ролей (РП, проектный отдел, снабжение, производство, прораб/ИТР, ОТ, ПТО, договорной). fileciteturn0file0  
Это определяет базовые экраны Mini App:

- карточка объекта (статус, ключевые даты, версия ГПР, отклонения),
- табличный просмотр/редактирование ГПР (с фильтрами по отделам/этапам),
- диаграмма Ганта,
- согласование/подписание ГПР по ролям,
- дашборд план/факт и рисков.

Важный нюанс из вашей статусной модели: объект проходит DRAFT → PLANNING → ACTIVE → (ON_HOLD) → COMPLETING → CLOSED; задачи — NEW/ASSIGNED/IN_PROGRESS/REVIEW/BLOCKED/DONE/OVERDUE. Mini App должен уважать эти блокировки (например, нельзя запускать «рабочие» операции до активации ГПР). fileciteturn0file0

### Контур «площадка»: фиксации, приёмка, дефекты, чек‑листы

По визуалу на скриншотах (интерфейс entity["company","SFERA HUB","b2b core system"] для entity["point_of_interest","ЖК «SKYLINE»","project prj-2026-14"]) «площадка» представлена как:

- роль пользователя крупной карточкой,
- «Журнал фиксации (площадка)» с быстрыми сценариями **создать**: «Акт приёмки фасада (КС‑2)», «Фиксация дефекта», и
- документная структура проекта папками: ПТО (акты/журналы), проектный (КМ/КМД), снабжение (счета), геодезия (схемы/3D), охрана труда (допуски), фотофиксация.

Это не просто UI‑стиль; это требование к структуре данных: Mini App должен поддерживать «журнальные» сущности (акт/дефект/фотофиксация) как первоклассные объекты, связанные с объектом, зоной/осями/этажом, задачей и документами.

В боте этот контур уже задуман через «construction: стадии монтажа + чек‑листы + сдача работ + фотофиксация», а также через «documents: хранение/версии/согласование». fileciteturn0file0

### Контур производственного план‑факта и объёмов

Отдельные таблицы «план‑факт / прогресс по датам / объёмы по этажам / бригады / виды работ / сводка / дашборд» логически требуют отдельного «производственного» слоя Mini App: ввод факта по смене/дню, привязка к этажу/фасаду, учёт выработки, статусы приёмки, накопительные итоги и визуализация отклонений.

Практический вывод: Mini App должен разделять:

- **норматив (план)** — из ГПР, недельных планов, объёмов,
- **факт** — журнал выполненных работ (строки факта),
- **приёмку** — статус и основания (акт/фото/замечания),
- **аналитику** — накопительные графики и отклонения.

Это совпадает с заявленной ролью системы как «операционный + транзакционный + аналитический инструмент» и с блоком «analytics/дашборды» в вашей модульной архитектуре. fileciteturn0file0

### Контур модулей и раскладок

Таблицы по модулям и «этапам запуска/отгрузки» требуют «реестра модулей» и их статусов (в наличии/отгружено/смонтировано/отсутствует/дефект). На практике это означает две сущности:

- **тип модуля** (паспорт: код/тип/габарит/единица),
- **экземпляр/пакет модуля в привязке к зоне** (оси‑этаж‑фасад‑этап).

В Mini App это лучше показывать не как «матрицу X в Excel», а как:
- список пакетов по этапам (что должно уехать/выйти/смонтироваться),
- карточку пакета: состав, статус, фото, замечания, сопроводительные документы,
- агрегированную аналитику по типам модулей (склад/монтаж/дефицит).

## Целевая модель объектов Mini App и связи

Ниже — как я рекомендую «нормализовать» вашу текущую логику (бот + таблицы) в устойчивую объектную модель. Это нужно, чтобы Mini App был не «набором экранов», а управляемой системой с расширяемостью.

### Объект строительства как корневая сущность

**Construction Object (Проект/Объект)** — корень, к которому привязано всё: ГПР, задачи, документы, поставки, стадии монтажа, журнал записей площадки, команды и права. fileciteturn0file0  

Рекомендуемая карточка объекта (минимум полей):
- идентификатор (внутренний ID + человекочитаемый код),
- заказчик/контакты (минимум «точка входа»),
- город/адрес,
- даты: договор, старт, план‑финиш,
- бюджет/договорная стоимость (если разрешено ролью),
- статус (DRAFT/PLANNING/ACTIVE/…),
- версия ГПР + подписи по отделам,
- риск‑индикаторы (просрочки, блокировки, каскадные сдвиги),
- быстрые действия по роли: «Открыть ГПР», «Документы», «Контроль/журналы», «Команда».

Эта декомпозиция следует из описанных сущностей и экранов бота («Мои объекты → детали объекта → ГПР/Поставки/Монтаж/Документы/Команда»). fileciteturn0file0

### ГПР как «план‑документ с версиями» и подписью

**GPR** — версия, статус, дата создания, инициатор, подписи руководителей/отделов. fileciteturn0file0  
**GPR Item** — строка/элемент работ (иерархия: раздел/работа/подработа), сроки, ответственный, примечания, зависимости (минимум — parent/child + логические связи).  

Ключевое требование Mini App: «табличный режим + Гант + фильтр + журнал изменений», потому что в чате это не поддерживается по объёму и UX‑ограничениям. fileciteturn0file0

### Задачи как «исполнение» и план‑факт слой

**Task** — операционная сущность: исполнитель, дедлайн, статус, блокировки, комментарии, вложения. fileciteturn0file0  
Чтобы связать таблицы план‑факт с управленческой логикой, рекомендую добавить поверх задач два слоя:

- **Work Type (Вид работ)** — справочник (код, ед. изм., последовательность, требует ли приёмку/ТН, типовая бригада).
- **Work Log (Запись факта)** — дата/смена, этаж, фасад/зона, вид работ, объём, бригада, людей, выработка, статус приёмки, примечания и медиа.

Так вы получаете единый «план‑факт» не как отдельный Excel, а как данные, которые можно агрегировать в дашборды и сопоставлять с ГПР.

### Документы как управляемая «архитектура проекта»

**Document** — тип, версия, файл, статус согласования, привязка к объекту и (опционально) к задаче/акту/дефекту. fileciteturn0file0  

С учётом UI на скриншоте целевая структура — **Directory (папка/категория) → документы**, плюс быстрый поиск по типам: «ПТО», «Проектный», «Снабжение», «Геодезия», «ОТ», «Фотофиксация». Это поддерживает «легальную» трассируемость: документ → задача → событие → подпись.

### Контроль площадки как отдельные объекты

Рекомендую формализовать минимум три типа «контрольных» объектов:

- **Acceptance Act / КС‑2‑сущность** (не обязательно полная бухгалтерская КС‑2 на старте, но объект «акт приёмки этапа/фасада» с реквизитами, объёмами, основаниями и подписью).
- **Defect** — тип, описание, зона (оси/этаж/фасад), фото/видео, критичность, ответственный, решение (принято/оспорено/в работе/закрыто), связь с задачей на устранение.
- **Photo Report** — пакет фото с метками зоны и контекстом (работа/дефект/приёмка).

Это напрямую соответствует вашим сценариям «брак при приёмке / акт дефектов / фотофиксация» и предложению делать это через Mini App. fileciteturn0file0

## Варианты Mini App по глубине: от запуска до цифрового контура

Ниже — три реалистичных варианта, чтобы не «закопаться» в идеале и при этом оставить путь к масштабированию.

### Вариант базовый

Фокус: закрыть то, что бот не может отрисовать, и дать площадке формы «создать».

Состав:
- карточка объекта (read‑mode + быстрые действия),
- просмотр ГПР в таблице (фильтр по отделам/статусам),
- «Документы» как папки/каталоги (просмотр + загрузка),
- «Контроль» как две формы: дефект + акт приёмки (с фото),
- персональный профиль сотрудника (роль/доступ/мои задачи/мои объекты).

Обмен с ботом: подтверждения/создания отправлять обратно в бот через WebApp API (для запуска уведомлений и записи audit‑логов). citeturn0search1

### Вариант рабочий

Фокус: сделать Mini App основным рабочим интерфейсом для РП, ПТО, снабжения, производства и прорабов.

Добавляется:
- диаграмма Ганта по ГПР + критический путь (хотя бы по зависимостям высокого уровня),
- подписание ГПР по отделам (с фиксацией «кто/когда/комментарий»),
- реестр поставок (статусы, даты, приёмка),
- монтажные стадии + чек‑листы + фотофиксация,
- план‑факт журнал работ (ввод факта по дню, накопление, приёмка),
- дашборд «план/факт + просрочки + блокеры» для РП.

Эта конфигурация полностью укладывается в описанную модульную структуру (gpr/tasks/supply/construction/documents/pto/safety/analytics/notifications/audit_log). fileciteturn0file0

### Вариант расширенный

Фокус: «единая операционная система проекта», где таблицы становятся данными, а не файлами.

Добавляется:
- импорт/синхронизация Excel‑шаблонов в объекты (с версионированием и сравнением),
- учёт модулей по этапам (реестр типов, пакеты, движение, дефицит),
- интеграции (двусторонняя синхронизация с entity["company","1С","enterprise software vendor"], уведомления в entity["company","WhatsApp","messaging app"]‑группы при критических событиях),
- PWA‑режим и офлайн‑работа на площадке с синхронизацией при появлении сети (критично для прорабов). fileciteturn0file0

## Создание объекта в Mini App и «карточка объекта» как центр управления

### Поток создания объекта

Рекомендованный «конвейер» создания (минимизирует ручные ошибки и фиксирует ответственность):

1) **Создать объект**  
   Поля: название, город/адрес, дата договора, план‑финиш, бюджет/стоимость (по правам), заказчик/контакты.

2) **Назначить команду и роли**  
   Привязать пользователей к объекту с ролями (РП, проектный, снабжение, производство, прораб/ИТР, ОТ, ПТО, договорной). fileciteturn0file0  
   Важно: назначение роли должно автоматически включать «контуры»: кому какие уведомления, какие формы доступны, какие папки документов видит.

3) **Сформировать базовую структуру документов**  
   Автосоздание директорий (ПТО/Проектный/Снабжение/Геодезия/ОТ/Фотофиксация) — как на вашем визуале.

4) **Поднять ГПР (baseline)**  
   Два режима:
   - «по шаблону» (загружается типовая структура строк, далее правка дат/ответственных),
   - «по экосистеме задач» (если вы хотите автогенерацию задач из вашей матрицы задач с триггерами, зависимостями и приоритетами).

5) **Подписание и активация**  
   Автоматический переход объекта в ACTIVE только после подписания ГПР всеми ответственными (или по политике компании). fileciteturn0file0

### Карточка объекта в стиле скриншотов

С учётом ваших скриншотов и реальной загрузки пользователей лучше делать карточку с верхним «хедером проекта» и вкладками:

- **Аналитика**: краткий KPI‑блок (план/факт, просрочки, блокеры), графики накопления.
- **Процессы**: ГПР (таблица/Гант), задачи по отделам, согласования.
- **Документы**: папки‑плитки + поиск + быстрые фильтры по типам и версиям.
- **Data Sync**: импорт/экспорт, статус синхронизаций (особенно если будет контур 1С).
- **Контроль**: «журнал фиксации» + быстрые действия «создать» (акт/дефект/фотоотчёт).

Ключевой момент: вкладка «Контроль» должна быть «полевой» — минимум кликов, большие кнопки, автоподстановка объекта/пользователя/даты, обязательные фото для критических событий. Это соответствует вашей постановке задачи про «обязательное фото при приёмке и сдаче этапов; Mini App с камерой». fileciteturn0file0

## Профиль сотрудника, доступы и функционал по ролям

### Карточка профиля

По скриншоту ваш целевой паттерн — «роль крупно + ID + уровень доступа». Это правильный UX для площадки: человек сразу понимает полномочия и контекст.

Рекомендуемая структура профиля:
- роль, отдел, уровень доступа,
- контакты (телефон, email — если используется),
- привязанные объекты (активные сверху),
- «мои задачи» (с сортировкой просрочено → сегодня → ближайшие),
- «мои согласования» (что нужно подписать/утвердить),
- история действий (минимум последние события — для самоконтроля).

Логику RBAC (кто что видит/создаёт/утверждает) целесообразно брать напрямую из вашей таблицы Role‑Based UX: например, РП видит всё и утверждает ключевые операции; снабжение работает с заявками и ТТН; прораб работает с монтажными этапами и актами; ПТО — с АОСР и исполнительной документацией; ОТ — с допусками. fileciteturn0file0

### Функциональные «пакеты» по ролям

Чтобы Mini App был внедряемым, рекомендую выдавать функционал пакетами:

- **РП / Руководители**: дашборд рисков и отклонений, Гант, утверждения, назначение ответственных, эскалации.
- **Проектный отдел**: задачи ОПР/КМ/КМД, выпуск/загрузка версий, фиксация замечаний от производства, статусы выдачи.
- **Снабжение**: заявки → закупка → отгрузка → приёмка; обязательная привязка ТТН/М15/счетов к объекту и поставке.
- **Производство**: готовность изделий/модулей, отгрузки, дефекты/возвраты, связка с КМД.
- **Прораб/ИТР**: факт работ по смене, чек‑листы этапов, фотофиксация, дефекты, приёмка.
- **ПТО**: АОСР/исполнительные схемы по этапам, акты сдачи, закрывающие пакеты документов. fileciteturn0file0

## Технические принципы реализации и трансформация таблиц в данные

### Авторизация и доверие данным пользователя

Для Mini App в Telegram «точка истины» по пользователю приходит в init data. Это должно проверяться сервер‑сайд; нельзя доверять `initDataUnsafe` без валидации подписи. citeturn0search0turn0search2  
Это особенно важно в вашей модели, потому что права (RBAC) управляют финансовыми, договорными и исполнительными данными. fileciteturn0file0

### Связка Mini App ↔ бот и событийнность

Ваша текущая логика построена на событиях (подписано → активировано; просрочено → эскалация; поставка задержана → каскадный пересчёт; дефект → задача на исправление). fileciteturn0file0  
Поэтому Mini App не должен жить отдельно: любое «создать/утвердить/изменить статус» должно:
- писать Audit Log (кто/что/когда),
- генерировать уведомления и deep‑links,
- при необходимости отдавать данные обратно боту через WebApp API, чтобы бот продолжал коммуникацию и пуш‑контуры. citeturn0search1

### Как “переварить” ваши таблицы без потери управляемости

Практический подход миграции таблиц в систему:

- **Импорт как версия**: любой Excel‑файл загружается как «версия данных» (например: версия ГПР, версия плана модулей, версия справочника видов работ). Это защищает от «тихих правок» и даёт сравнение версий.
- **Нормализация**: что повторяется (вид работ, бригада, тип модуля, зона) — выносится в справочники; всё остальное становится транзакциями (лог факта, акт, дефект, поставка).
- **Валидации на входе**: единицы измерения, уникальность кодов, дата/этаж/фасад обязательны для «факта», наличие фото обязательно для дефектов и приёмок (как вы и закладывали). fileciteturn0file0

### Масштабирование и эксплуатация

Ваш документ уже фиксирует направления масштабирования: кэш/очереди, файловое хранилище, двусторонняя синхронизация, PWA‑офлайн. fileciteturn0file0  
Mini App стоит проектировать так, чтобы:
- таблицы (ГПР/план‑факт) не «ложились» на один запрос (серверная пагинация, фильтры),
- документы были в S3‑подобном хранилище и привязаны к сущности (задаче/поставке/дефекту),
- критические изменения фиксировались в audit‑лог и были объяснимы (кто сдвинул сроки и почему). fileciteturn0file0